# Overview: Version v0.3.x-alpha (ARC01-USER)

## 1. Version Details

- **Name**: `v0.3.x-alpha`
- **Series Code**: `ARC01-USER`
- **Status**: `In Progress`
- **Description**: This version focuses on implementing the complete user lifecycle management and
  personalized profile systems. It builds upon the RBAC and Shared systems established in the
  previous phase to provide a secure and user-centric experience.

---

## 2. Goals & Architectural Philosophy (Pre-Production)

### Problem Keypoints

- **Fragmented User Data:** Ensuring all user types (Admin, Student, Teacher) share a consistent
  base model while having specialized profiles.
- **Manual Account Provisioning:** The need for automated and secure user creation workflows.
- **Auth Experience:** Refining the authentication and verification flows for a production-ready
  feel.

### Architectural Pillars

- **Identity & Access Integration:** Leveraging the `Permission` module for all user-related
  authorization.
- **Profile Polymorphism:** Handling specialized profile data through modular relations.
- **Self-Service UI:** Providing intuitive Livewire components for profile editing and security
  settings.

### Architectural Constraints (The Rules)

1.  **Strict Isolation:** The `User` module must not directly depend on `Profile` models;
    communication must use contracts or polymorphic relations.
2.  **Service-Driven CRUD:** All administrative actions and profile updates must pass through the
    Service layer to ensure validation and event dispatching.
3.  **UI Consistency:** All new interfaces must use the `UI` module components or MaryUI wrappers.
4.  **PII Protection:** Personal Identifiable Information (PII) must be handled securely and not
    exposed in logs or insecure state.

---

## 3. System Keystones (Production)

### Keystone 1: Administrative User Management

- **Goal**: To provide a robust and secure administrative interface for managing the system's
  identity foundation.
- **Implementation**:
    - **Approach**: Implemented a full CRUD interface in the `User` module. Integrated
      `spatie/laravel-model-status` to allow admins to activate/deactivate accounts.
    - **Analysis**: Administrative forms dynamically adapt to show specific fields based on selected
      roles (e.g., NIP/NISN).
- **Developer Impact**: Centralizes user lifecycle management, reducing manual database
  interventions.

### Keystone 2: Specialized Profile Polymorphism

- **Goal**: To handle role-specific data (Students/Teachers) while maintaining a unified core user
  model.
- **Implementation**:
    - **Approach**: Enhanced `UserService` to automatically initialize specialized profile records
      during user creation.
    - **Analysis**: Utilized a `Profile` module with polymorphic-like modular relations to separate
      core auth data from professional details.
- **Developer Impact**: Enables easy extension for future roles (e.g., Parents, School Staff)
  without modifying the core `User` table.

### Keystone 3: Self-Service Dashboard & UI Foundation

- **Goal**: To empower users to manage their own data and security settings independently.
- **Implementation**:
    - **Approach**: Developed a unified dashboard in the `Profile` module using a tabbed Livewire
      interface. Conducted an asset audit in the `UI` module to standardize components.
    - **Analysis**: Categorized Blade components into Layouts, Forms, Navigation, Display, and
      Utilities for better reusability.
- **Developer Impact**: Reduces administrative overhead by providing secure self-service
  capabilities.

### Keystone 4: Authentication Experience & Flow

- **Goal**: To provide a modern, role-aware authentication journey.
- **Implementation**:
    - **Approach**: Implemented `RedirectService` for intelligent post-login redirection (Students
      to journals, Admins to management).
    - **Analysis**: Refined Auth views using standard `UI` components and `AppException` for
      localized error feedback.
    - **Contextual Communications**: Customized email verification templates to reflect
      school-specific context and professional tone.
- **Developer Impact**: Improves user onboarding and ensures users land in the context relevant to
  their role.

- [x] **Email Verification:** Ensure mandatory verification for **Students** and **Teachers** to
      secure the platform.

---

## 4. Completed Milestones Details (Keystones Continued)

### Keystone 5: Quality Assurance & Infrastructure Stability

- **Goal**: To ensure the reliability of core features and the integrity of the modular
  architecture.
- **Implementation**:
    - **Testing**: Developed a comprehensive Pest test suite covering registration flows, role-based
      redirection, and email verification logic.
    - **Infrastructure**: Conducted a mass-fix of namespace inconsistencies across multiple modules
      (`School`, `Department`, `Internship`, `Auth`, `Setup`) to ensure standard-compliant service
      binding.
    - **Localization**: Validated and repaired global translation files (`id.json`) to support
      stable multi-language feedback.
- **Developer Impact**: Provides a stable foundation for future modules and ensures that
  architectural boundaries are strictly enforced and discoverable.

### Keystone 6: Security Remediation & Hardening

- **Goal**: To eliminate identified vulnerabilities and strengthen the application's security
  posture.
- **Implementation**:
    - **Auth Bypass Fix**: Removed automatic login in `VerifyEmail` and added explicit ownership
      verification.
    - **IDOR Prevention**: Implemented mandatory `Gate::authorize` and `$this->authorize` checks
      across `UserService` and administrative Livewire components.
    - **Privacy Protection**: Integrated email masking in application logs to prevent PII leaks
      while maintaining debugging capabilities.
- **Developer Impact**: Ensures a "Security-by-Design" approach where all business operations are
  protected by explicit authorization and data privacy standards.

---

## 5. Quality Assurance & Finalization (Post-Production)

...

### 5.2. Verification Checklist

- [x] **User Management Test:** Verified via `UserServiceTest` and manual administrative flow.
- [x] **Self-Profile Test:** Verified via `ProfileIndexTest`.
- [x] **Security Audit:** Conducted comprehensive security and privacy audit; all identified issues
      remediated.
- [x] **Feature Integrity:** All 14 tests (30 assertions) passed successfully across Auth, User, and
      Profile modules.

### 5.3. Documentation Checks

- [x] **Profile Polymorphism:** Documentation for handling specialized roles (Student/Teacher) via
      modular relations.
- [x] **Role-Based Redirection:** Documentation for post-login redirection logic and standards.
- [x] **Contextual Notifications:** Documentation for custom email templates and school-centric
      communication standards.
- [x] **Security Hardening:** Documented fixes for Auth Bypass, IDOR, and PII leaks.
- [ ] **Account Status Management:** Convention for using model statuses in User accounts.
- [x] **User Policies:** Documentation for administrative permissions and access control.
- [x] **Multi-language Support:** Verification that all User/Profile strings are localized (EN/ID).
- [x] **Root TOC & Module TOCs:** Ensure all new guides are linked correctly.

### 5.4. Security Issues

- **[FIXED] Critical: Authentication Bypass in Email Verification:** Removed unvalidated automatic
  login logic.
- **[FIXED] High: Broken Access Control (IDOR) in User Management:** Enforced explicit policy checks
  in Service and UI layers.
- **[FIXED] Medium: PII Leak in Logs:** Implemented email masking for all authentication-related
  logging.

### 4.5. Roadmap & Next Steps

- Implementation of the **School** and **Department** management.
- Foundational **Internship** registration workflows.
- Development of a standardized **Language Switcher** component in the `UI` module.

---

**Navigation**

[‚Üê Previous: v0.2.x-alpha (Core & Shared)](v0.2.x-alpha.md)
