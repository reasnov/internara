# Overview: Version v0.3.x-alpha (ARC01-USER)

## 1. Version Details

-   **Name**: `v0.3.x-alpha`
-   **Series Code**: `ARC01-USER`
-   **Status**: `In Progress`
-   **Description**: This version focuses on implementing the complete user lifecycle management and personalized profile systems. It builds upon the RBAC and Shared systems established in the previous phase to provide a secure and user-centric experience.

---

## 2. Goals & Architectural Philosophy (Pre-Production)

### Problem Keypoints

-   **Fragmented User Data:** Ensuring all user types (Admin, Student, Teacher) share a consistent base model while having specialized profiles.
-   **Manual Account Provisioning:** The need for automated and secure user creation workflows.
-   **Auth Experience:** Refining the authentication and verification flows for a production-ready feel.

### Architectural Pillars

-   **Identity & Access Integration:** Leveraging the `Permission` module for all user-related authorization.
-   **Profile Polymorphism:** Handling specialized profile data through modular relations.
-   **Self-Service UI:** Providing intuitive Livewire components for profile editing and security settings.

### Architectural Constraints (The Rules)

1.  **Strict Isolation:** The `User` module must not directly depend on `Profile` models; communication must use contracts or polymorphic relations.
2.  **Service-Driven CRUD:** All administrative actions and profile updates must pass through the Service layer to ensure validation and event dispatching.
3.  **UI Consistency:** All new interfaces must use the `UI` module components or MaryUI wrappers.
4.  **PII Protection:** Personal Identifiable Information (PII) must be handled securely and not exposed in logs or insecure state.

---

## 3. System Keystones (Production)

### Keystone 1: Administrative User Management

-   **Goal**: To provide a robust and secure administrative interface for managing the system's identity foundation.
-   **Implementation**:
    -   **Approach**: Implemented a full CRUD interface in the `User` module. Integrated `spatie/laravel-model-status` to allow admins to activate/deactivate accounts.
    -   **Analysis**: Administrative forms dynamically adapt to show specific fields based on selected roles (e.g., NIP/NISN).
-   **Developer Impact**: Centralizes user lifecycle management, reducing manual database interventions.

### Keystone 2: Specialized Profile Polymorphism

-   **Goal**: To handle role-specific data (Students/Teachers) while maintaining a unified core user model.
-   **Implementation**:
    -   **Approach**: Enhanced `UserService` to automatically initialize specialized profile records during user creation.
    -   **Analysis**: Utilized a `Profile` module with polymorphic-like modular relations to separate core auth data from professional details.
-   **Developer Impact**: Enables easy extension for future roles (e.g., Parents, School Staff) without modifying the core `User` table.

### Keystone 3: Self-Service Dashboard & UI Foundation

-   **Goal**: To empower users to manage their own data and security settings independently.
-   **Implementation**:
    -   **Approach**: Developed a unified dashboard in the `Profile` module using a tabbed Livewire interface. Conducted an asset audit in the `UI` module to standardize components.
    -   **Analysis**: Categorized Blade components into Layouts, Forms, Navigation, Display, and Utilities for better reusability.
-   **Developer Impact**: Reduces administrative overhead by providing secure self-service capabilities.

### Keystone 4: Authentication Experience & Flow

-   **Goal**: To provide a modern, role-aware authentication journey.
-   **Implementation**:
    -   **Approach**: Implemented `RedirectService` for intelligent post-login redirection (Students to journals, Admins to management).
    -   **Analysis**: Refined Auth views using standard `UI` components and `AppException` for localized error feedback.
    -   **Contextual Communications**: Customized email verification templates to reflect school-specific context and professional tone.
-   **Developer Impact**: Improves user onboarding and ensures users land in the context relevant to their role.

---

## 4. Quality Assurance & Finalization (Post-Production)

### 4.1. Quality Tooling Setup

-   [x] **App Info Command:** `php artisan app:info` implemented to monitor environment details.
-   [x] **Pest Integration:** Test suites updated to discover module-level tests.
-   [x] **Asset Audit:** `UI` module components documented and verified.

### 4.2. Verification Checklist

-   [ ] **User Management Test:** Verify that administrators can manage users while respecting RBAC.
-   [ ] **Self-Profile Test:** Verify that users can only edit their own profile data.
-   [x] **Security Audit:** Conducted comprehensive security and privacy audit of User, Profile, and Auth modules.

### 4.3. Documentation Checks

-   [ ] **Profile Polymorphism:** Documentation for handling specialized roles (Student/Teacher) via modular relations.
-   [ ] **Role-Based Redirection:** Documentation for post-login redirection logic and standards.
-   [ ] **Contextual Notifications:** Documentation for custom email templates and school-centric communication standards.
-   [ ] **Account Status Management:** Convention for using model statuses in User accounts.
-   [ ] **User Policies:** Documentation for administrative permissions and access control.
-   [ ] **Multi-language Support:** Verification that all User/Profile strings are localized (EN/ID).
-   [ ] **Root TOC & Module TOCs:** Ensure all new guides are linked correctly.

### 4.4. Security Issues

-   **Critical: Authentication Bypass in Email Verification:** The `VerifyEmail` component automatically logs in users based on unvalidated IDs in Livewire actions, allowing for potential account takeover.
-   **High: Broken Access Control (IDOR) in User Management:** Lack of explicit policy enforcement in `UserForm` and `UserService` allows users with `user.update` permission to modify unauthorized accounts (e.g., SuperAdmin).
-   **Medium: PII Leak in Logs:** Plaintext email addresses are being recorded in application logs via `AuthService` and `AppException`.

### 4.5. Roadmap & Next Steps

-   Implementation of the **School** and **Department** management.
-   Foundational **Internship** registration workflows.
-   Development of a standardized **Language Switcher** component in the `UI` module.

---

**Navigation**

[‚Üê Previous: v0.2.x-alpha (Core & Shared)](v0.2.x-alpha.md)